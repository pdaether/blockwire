(function(){"use strict";window.blockwire=c=>({iframe:null,dropList:null,insert:!1,device:"desktop",lastTopPos:0,cursorPos:0,currentDragItem:null,activeBlockId:null,showJsonModal:!1,jsonPayload:"",loadingJson:!1,copyStatus:"",insertBeforeClasses:["after:opacity-100","after:top-0","after:h-[5px]"],insertAfterClasses:["after:opacity-100","after:bottom-0","after:h-[5px]"],async openJsonModal(){this.loadingJson=!0,this.copyStatus="";try{const e=await this.component().call("getJsonSnapshot");this.jsonPayload=e,this.showJsonModal=!0}catch(e){console.error("Failed to fetch JSON snapshot:",e)}finally{this.loadingJson=!1}},async copyToClipboard(){try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(this.jsonPayload);else{const e=document.createElement("textarea");e.value=this.jsonPayload,e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}this.copyStatus="Copied!",setTimeout(()=>this.copyStatus="",2e3)}catch(e){console.error("Copy failed:",e),this.copyStatus="Failed to copy"}},closeJsonModal(){this.showJsonModal=!1,this.copyStatus=""},init(){this.iframe=document.getElementById("frame"),this.dropList=document.querySelector("[drop-list]"),document.addEventListener("keydown",e=>this.undo(e,this)),document.addEventListener("keydown",e=>this.redo(e,this)),this.initListeners(),this.iframe.addEventListener("load",()=>{if(this.initListeners(),this.activeBlockId!==null&&this.activeBlockId!==!1){let e=this.iframe.contentWindow.document,r=e.querySelector('[drag-item][data-block="'+this.activeBlockId+'"]');r&&(e.querySelectorAll("[drag-item]").forEach(s=>{s.classList.remove("active")}),r.classList.add("active"))}this.iframe.contentWindow.scrollTo(0,this.lastTopPos)}),Livewire.on("activeBlockIndexChanged",e=>{if(this.activeBlockId=e,this.iframe&&this.iframe.contentWindow){let r=this.iframe.contentWindow.document;if(r.querySelectorAll("[drag-item]").forEach(s=>{s.classList.remove("active")}),e!==!1&&e!==null){let s=r.querySelector('[drag-item][data-block="'+e+'"]');s&&s.classList.add("active")}}})},initListeners(){let e=this.iframe.contentWindow.document;e.addEventListener("keydown",r=>this.undo(r,this)),e.addEventListener("keydown",r=>this.redo(r,this)),this.dropList.querySelectorAll("[drag-item]").forEach(r=>{r.addEventListener("dragstart",s=>{s.target.setAttribute("inserting",!0)}),r.addEventListener("dragend",s=>{s.target.removeAttribute("inserting")}),r.addEventListener("dragover",s=>s.preventDefault())}),e.querySelectorAll("[drop-placeholder]").forEach(r=>{r.addEventListener("dragover",s=>s.preventDefault()),r.addEventListener("dragenter",s=>{s.preventDefault(),s.target.classList.add("bg-gray-200/50","animate-pulse")}),r.addEventListener("dragleave",s=>{s.preventDefault(),s.target.classList.remove("bg-gray-200/50","animate-pulse")}),r.addEventListener("drop",s=>{if(s.preventDefault(),!s.target.closest("[drop-placeholder]"))return;let o=document.querySelector("[inserting]");if(o!=null){this.component().call("insertBlock",o.dataset.block,0),o.removeAttribute("inserting"),o=!1;return}})}),e.querySelectorAll("[drag-item]").forEach(r=>{let s=r.querySelector(".action-clone");s&&s.addEventListener("click",t=>{t.stopPropagation();let i=t.target.closest("[drag-item]").dataset.block;this.component().call("cloneBlock",i)});let o=r.querySelector(".action-delete");o&&o.addEventListener("click",t=>{t.stopPropagation();let i=t.target.closest("[drag-item]").dataset.block;this.component().call("deleteBlock",i)}),r.addEventListener("click",t=>{if(t.target.closest(".action-clone")||t.target.closest(".action-delete"))return;let i=t.target.closest("[drag-item]"),a=i.dataset.block;this.activeBlockId=a,e.querySelectorAll("[drag-item]").forEach(n=>{n.classList.remove("active")}),i.classList.add("active"),Livewire.dispatch("blockEditComponentSelected",{blockId:a})},!1),r.addEventListener("dragstart",t=>{t.target.setAttribute("dragging",!0),this.currentDragItem=r}),r.addEventListener("dragover",t=>{t.preventDefault();let i=t.target.closest("[drag-item]");if(this.currentDragItem===i)return;let a=this.beforeOrAfterEl(t,i),n=this.currentDragItem!=null?this.currentDragItem.previousElementSibling:!1,l=this.currentDragItem!=null?this.currentDragItem.nextElementSibling:!1;i!=l&&a==="before"?(i.classList.remove(...this.insertAfterClasses),i.classList.add(...this.insertBeforeClasses)):i!=n&&a==="after"?(i.classList.remove(...this.insertBeforeClasses),i.classList.add(...this.insertAfterClasses)):i.classList.remove(...this.insertBeforeClasses,...this.insertAfterClasses)}),r.addEventListener("dragend",t=>{t.target.removeAttribute("dragging"),this.currentDragItem=null}),r.addEventListener("dragenter",t=>{t.target.hasAttribute("drag-item")&&t.target.setAttribute("is-target",!0)}),r.addEventListener("dragleave",t=>{t.preventDefault(),t.target.hasAttribute("is-target")&&t.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses)}),r.addEventListener("drop",t=>{t.preventDefault();let i=e.querySelector("[dragging]"),a=document.querySelector("[inserting]");if(!t.target.closest("[drag-item]"))return;t.target.hasAttribute("drag-item")&&t.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses),this.lastTopPos=e.documentElement.scrollTop;let n=this.beforeOrAfterEl(t,t.target.closest("[drag-item]"));if(a!=null){this.component().call("insertBlock",a.dataset.block,t.target.closest("[drag-item]").dataset.block,n),a.removeAttribute("inserting"),a=!1;return}n==="after"?t.target.closest("[drag-item]").after(i):t.target.closest("[drag-item]").before(i);let l=Array.from(e.querySelectorAll("[drag-item]")).map(d=>d.dataset.block);this.component().call("reorder",l)})})},isBefore(e,r,s){let o=!1,t=!1,i=!1;return e.querySelectorAll("[drag-item]").forEach(a=>{if(!i&&(o=o?!0:a==r,t=t?!0:a==s,o===!1&&t===!0)){i=!0;return}}),i},beforeOrAfterEl(e,r){let s=r.getBoundingClientRect(),o=s.y,t=o+s.height/2,i=t,a=i+s.height/2,n=e.clientY>=o&&e.clientY<=t,l=e.clientY>=i&&e.clientY<=a;return n?"before":l?"after":!1},component(){return Livewire.find(frame.closest("[wire\\:id]").getAttribute("wire:id"))},undo(e,r){(e.ctrlKey||e.metaKey)&&!e.shiftKey&&e.key==="z"&&(e.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),r.component().call("undo"))},redo(e,r){(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="z"&&(e.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),r.component().call("redo"))}})})();
