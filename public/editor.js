(function(){"use strict";window.blockwire=c=>({iframe:null,dropList:null,insert:!1,device:"desktop",desktopPreviewWidth:1024,sidebarVisible:!0,panelWidth:380,panelMinWidth:260,previewMinWidth:320,isResizingPanel:!1,movePanelResizeHandler:null,stopPanelResizeHandler:null,resizeWindowHandler:null,panelWidthStorageKey:"blockwire-panel-width",panelWidthCustomizedStorageKey:"blockwire-panel-width-customized",lastTopPos:0,cursorPos:0,currentDragItem:null,activeBlockId:null,showJsonModal:!1,jsonPayload:"",loadingJson:!1,copyStatus:"",insertBeforeClasses:["after:opacity-100","after:top-0","after:h-[5px]"],insertAfterClasses:["after:opacity-100","after:bottom-0","after:h-[5px]"],async openJsonModal(){this.loadingJson=!0,this.copyStatus="";try{const e=await this.component().call("getJsonSnapshot");this.jsonPayload=e,this.showJsonModal=!0}catch(e){console.error("Failed to fetch JSON snapshot:",e)}finally{this.loadingJson=!1}},async copyToClipboard(){try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(this.jsonPayload);else{const e=document.createElement("textarea");e.value=this.jsonPayload,e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}this.copyStatus="Copied!",setTimeout(()=>this.copyStatus="",2e3)}catch(e){console.error("Copy failed:",e),this.copyStatus="Failed to copy"}},closeJsonModal(){this.showJsonModal=!1,this.copyStatus=""},init(){this.iframe=document.getElementById("frame"),this.dropList=document.querySelector("[drop-list]"),this.restorePanelWidth(),this.$nextTick(()=>{this.captureDesktopPreviewWidth(),this.panelWidth=this.clampPanelWidth(this.panelWidth)}),this.resizeWindowHandler=()=>{this.captureDesktopPreviewWidth(),this.panelWidth=this.clampPanelWidth(this.panelWidth)},window.addEventListener("resize",this.resizeWindowHandler),document.addEventListener("keydown",e=>this.undo(e,this)),document.addEventListener("keydown",e=>this.redo(e,this)),this.initListeners(),this.iframe.addEventListener("load",()=>{if(this.initListeners(),this.activeBlockId!==null&&this.activeBlockId!==!1){let e=this.iframe.contentWindow.document,t=e.querySelector('[drag-item][data-block="'+this.activeBlockId+'"]');t&&(e.querySelectorAll("[drag-item]").forEach(r=>{r.classList.remove("active")}),t.classList.add("active"))}this.iframe.contentWindow.scrollTo(0,this.lastTopPos)}),Livewire.on("activeBlockIndexChanged",e=>{if(this.activeBlockId=e,this.iframe&&this.iframe.contentWindow){let t=this.iframe.contentWindow.document;if(t.querySelectorAll("[drag-item]").forEach(r=>{r.classList.remove("active")}),e!==!1&&e!==null){let r=t.querySelector('[drag-item][data-block="'+e+'"]');r&&r.classList.add("active")}}})},restorePanelWidth(){try{if(window.localStorage.getItem(this.panelWidthCustomizedStorageKey)!=="1")return;let t=window.localStorage.getItem(this.panelWidthStorageKey);if(t===null)return;let r=Number(t);Number.isFinite(r)&&(this.panelWidth=r)}catch{}},persistPanelWidth(){try{window.localStorage.setItem(this.panelWidthStorageKey,String(this.panelWidth)),window.localStorage.setItem(this.panelWidthCustomizedStorageKey,"1")}catch{}},captureDesktopPreviewWidth(){if(!this.$refs.previewContainer)return;let e=Math.floor(this.$refs.previewContainer.getBoundingClientRect().width);e>=this.previewMinWidth&&(this.desktopPreviewWidth=e)},previewWidth(){return this.device==="mobile"?320:this.device==="tablet"?768:this.desktopPreviewWidth},panelStyle(){return`width: ${this.panelWidth}px`},clampPanelWidth(e){let t=this.getPanelMaxWidth();return Math.max(this.panelMinWidth,Math.min(Math.floor(e),t))},getPanelMaxWidth(){if(!this.$refs.workspace)return this.panelWidth;let e=Math.floor(this.$refs.workspace.getBoundingClientRect().width);if(e<=0)return this.panelWidth;let t=e-this.previewMinWidth;return Math.max(this.panelMinWidth,t)},resizePanelBy(e){this.panelWidth=this.clampPanelWidth(this.panelWidth+e),this.persistPanelWidth()},toggleSidebar(){this.isResizingPanel&&this.stopPanelResize(),this.sidebarVisible=!this.sidebarVisible,this.sidebarVisible&&(this.panelWidth=this.clampPanelWidth(this.panelWidth)),this.$nextTick(()=>{this.captureDesktopPreviewWidth()})},startPanelResize(e){this.sidebarVisible&&(e.preventDefault(),this.isResizingPanel=!0,document.body.style.userSelect="none",this.movePanelResizeHandler=t=>{this.updatePanelWidthFromPointer(t)},this.stopPanelResizeHandler=()=>{this.stopPanelResize()},window.addEventListener("mousemove",this.movePanelResizeHandler),window.addEventListener("touchmove",this.movePanelResizeHandler,{passive:!1}),window.addEventListener("mouseup",this.stopPanelResizeHandler,{once:!0}),window.addEventListener("touchend",this.stopPanelResizeHandler,{once:!0}),this.updatePanelWidthFromPointer(e))},stopPanelResize(){this.isResizingPanel=!1,document.body.style.userSelect="",this.movePanelResizeHandler&&(window.removeEventListener("mousemove",this.movePanelResizeHandler),window.removeEventListener("touchmove",this.movePanelResizeHandler),this.movePanelResizeHandler=null),this.stopPanelResizeHandler&&(window.removeEventListener("mouseup",this.stopPanelResizeHandler),window.removeEventListener("touchend",this.stopPanelResizeHandler),this.stopPanelResizeHandler=null)},updatePanelWidthFromPointer(e){if(!this.$refs.workspace)return;e.cancelable&&e.preventDefault();let t=e.touches?e.touches[0].clientX:e.clientX;if(typeof t!="number")return;let a=this.$refs.workspace.getBoundingClientRect().right-t;this.panelWidth=this.clampPanelWidth(a),this.persistPanelWidth()},initListeners(){let e=this.iframe.contentWindow.document;e.addEventListener("keydown",t=>this.undo(t,this)),e.addEventListener("keydown",t=>this.redo(t,this)),this.dropList.querySelectorAll("[drag-item]").forEach(t=>{t.addEventListener("dragstart",r=>{r.target.setAttribute("inserting",!0)}),t.addEventListener("dragend",r=>{r.target.removeAttribute("inserting")}),t.addEventListener("dragover",r=>r.preventDefault())}),e.querySelectorAll("[drop-placeholder]").forEach(t=>{t.addEventListener("dragover",r=>r.preventDefault()),t.addEventListener("dragenter",r=>{r.preventDefault(),r.target.classList.add("bg-gray-200/50","animate-pulse")}),t.addEventListener("dragleave",r=>{r.preventDefault(),r.target.classList.remove("bg-gray-200/50","animate-pulse")}),t.addEventListener("drop",r=>{if(r.preventDefault(),!r.target.closest("[drop-placeholder]"))return;let a=document.querySelector("[inserting]");if(a!=null){this.component().call("insertBlock",a.dataset.block,0),a.removeAttribute("inserting"),a=!1;return}})}),e.querySelectorAll("[drag-item]").forEach(t=>{let r=t.querySelector(".action-clone");r&&r.addEventListener("click",i=>{i.stopPropagation();let s=i.target.closest("[drag-item]").dataset.block;this.component().call("cloneBlock",s)});let a=t.querySelector(".action-delete");a&&a.addEventListener("click",i=>{i.stopPropagation();let s=i.target.closest("[drag-item]").dataset.block;this.component().call("deleteBlock",s)}),t.addEventListener("click",i=>{if(i.target.closest(".action-clone")||i.target.closest(".action-delete"))return;let s=i.target.closest("[drag-item]"),n=s.dataset.block;this.activeBlockId=n,e.querySelectorAll("[drag-item]").forEach(l=>{l.classList.remove("active")}),s.classList.add("active"),Livewire.dispatch("blockEditComponentSelected",{blockId:n})},!1),t.addEventListener("dragstart",i=>{i.target.setAttribute("dragging",!0),this.currentDragItem=t}),t.addEventListener("dragover",i=>{i.preventDefault();let s=i.target.closest("[drag-item]");if(this.currentDragItem===s)return;let n=this.beforeOrAfterEl(i,s),l=this.currentDragItem!=null?this.currentDragItem.previousElementSibling:!1,o=this.currentDragItem!=null?this.currentDragItem.nextElementSibling:!1;s!=o&&n==="before"?(s.classList.remove(...this.insertAfterClasses),s.classList.add(...this.insertBeforeClasses)):s!=l&&n==="after"?(s.classList.remove(...this.insertBeforeClasses),s.classList.add(...this.insertAfterClasses)):s.classList.remove(...this.insertBeforeClasses,...this.insertAfterClasses)}),t.addEventListener("dragend",i=>{i.target.removeAttribute("dragging"),this.currentDragItem=null}),t.addEventListener("dragenter",i=>{i.target.hasAttribute("drag-item")&&i.target.setAttribute("is-target",!0)}),t.addEventListener("dragleave",i=>{i.preventDefault(),i.target.hasAttribute("is-target")&&i.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses)}),t.addEventListener("drop",i=>{i.preventDefault();let s=e.querySelector("[dragging]"),n=document.querySelector("[inserting]");if(!i.target.closest("[drag-item]"))return;i.target.hasAttribute("drag-item")&&i.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses),this.lastTopPos=e.documentElement.scrollTop;let l=this.beforeOrAfterEl(i,i.target.closest("[drag-item]"));if(n!=null){this.component().call("insertBlock",n.dataset.block,i.target.closest("[drag-item]").dataset.block,l),n.removeAttribute("inserting"),n=!1;return}l==="after"?i.target.closest("[drag-item]").after(s):i.target.closest("[drag-item]").before(s);let o=Array.from(e.querySelectorAll("[drag-item]")).map(d=>d.dataset.block);this.component().call("reorder",o)})})},isBefore(e,t,r){let a=!1,i=!1,s=!1;return e.querySelectorAll("[drag-item]").forEach(n=>{if(!s&&(a=a?!0:n==t,i=i?!0:n==r,a===!1&&i===!0)){s=!0;return}}),s},beforeOrAfterEl(e,t){let r=t.getBoundingClientRect(),a=r.y,i=a+r.height/2,s=i,n=s+r.height/2,l=e.clientY>=a&&e.clientY<=i,o=e.clientY>=s&&e.clientY<=n;return l?"before":o?"after":!1},component(){return Livewire.find(frame.closest("[wire\\:id]").getAttribute("wire:id"))},undo(e,t){(e.ctrlKey||e.metaKey)&&!e.shiftKey&&e.key==="z"&&(e.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),t.component().call("undo"))},redo(e,t){(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="z"&&(e.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),t.component().call("redo"))}})})();
