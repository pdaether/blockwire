(function(){"use strict";window.dropblockeditor=d=>({iframe:null,dropList:null,insert:!1,device:"desktop",lastTopPos:0,cursorPos:0,currentDragItem:null,activeBlockId:null,insertBeforeClasses:["after:opacity-100","after:top-0","after:h-[5px]"],insertAfterClasses:["after:opacity-100","after:bottom-0","after:h-[5px]"],init(){this.iframe=document.getElementById("frame"),this.dropList=document.querySelector("[drop-list]"),document.addEventListener("keydown",t=>this.undo(t,this)),document.addEventListener("keydown",t=>this.redo(t,this)),this.initListeners(),this.iframe.addEventListener("load",()=>{if(this.initListeners(),this.activeBlockId!==null&&this.activeBlockId!==!1){let t=this.iframe.contentWindow.document,r=t.querySelector('[drag-item][data-block="'+this.activeBlockId+'"]');r&&(t.querySelectorAll("[drag-item]").forEach(e=>{e.classList.remove("active")}),r.classList.add("active"))}this.iframe.contentWindow.scrollTo(0,this.lastTopPos)}),Livewire.on("activeBlockIndexChanged",t=>{if(this.activeBlockId=t,this.iframe&&this.iframe.contentWindow){let r=this.iframe.contentWindow.document;if(r.querySelectorAll("[drag-item]").forEach(e=>{e.classList.remove("active")}),t!==!1&&t!==null){let e=r.querySelector('[drag-item][data-block="'+t+'"]');e&&e.classList.add("active")}}})},initListeners(){let t=this.iframe.contentWindow.document;t.addEventListener("keydown",r=>this.undo(r,this)),t.addEventListener("keydown",r=>this.redo(r,this)),this.dropList.querySelectorAll("[drag-item]").forEach(r=>{r.addEventListener("dragstart",e=>{e.target.setAttribute("inserting",!0)}),r.addEventListener("dragend",e=>{e.target.removeAttribute("inserting")}),r.addEventListener("dragover",e=>e.preventDefault())}),t.querySelectorAll("[drop-placeholder]").forEach(r=>{r.addEventListener("dragover",e=>e.preventDefault()),r.addEventListener("dragenter",e=>{e.preventDefault(),e.target.classList.add("bg-gray-200/50","animate-pulse")}),r.addEventListener("dragleave",e=>{e.preventDefault(),e.target.classList.remove("bg-gray-200/50","animate-pulse")}),r.addEventListener("drop",e=>{if(e.preventDefault,!e.target.closest("[drop-placeholder]"))return;let i=document.querySelector("[inserting]");if(i!=null){this.component().call("insertBlock",i.dataset.block,0),i.removeAttribute("inserting"),i=!1;return}})}),t.querySelectorAll("[drag-item]").forEach(r=>{r.addEventListener("click",e=>{let i=e.target.closest("[drag-item]"),s=i.dataset.block;this.activeBlockId=s,t.querySelectorAll("[drag-item]").forEach(a=>{a.classList.remove("active")}),i.classList.add("active"),Livewire.dispatch("blockEditComponentSelected",{blockId:s})},!1),r.addEventListener("dragstart",e=>{e.target.setAttribute("dragging",!0),this.currentDragItem=r}),r.addEventListener("dragover",e=>{e.preventDefault();let i=e.target.closest("[drag-item]");if(this.currentDragItem===i)return;let s=this.beforeOrAfterEl(e,i),a=this.currentDragItem!=null?this.currentDragItem.previousElementSibling:!1,n=this.currentDragItem!=null?this.currentDragItem.nextElementSibling:!1;i!=n&&s==="before"?(i.classList.remove(...this.insertAfterClasses),i.classList.add(...this.insertBeforeClasses)):i!=a&&s==="after"?(i.classList.remove(...this.insertBeforeClasses),i.classList.add(...this.insertAfterClasses)):i.classList.remove(...this.insertBeforeClasses,...this.insertAfterClasses)}),r.addEventListener("dragend",e=>{e.target.removeAttribute("dragging"),this.currentDragItem=null}),r.addEventListener("dragenter",e=>{e.target.hasAttribute("drag-item")&&e.target.setAttribute("is-target",!0)}),r.addEventListener("dragleave",e=>{e.preventDefault,e.target.hasAttribute("is-target")&&e.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses)}),r.addEventListener("drop",e=>{e.preventDefault;let i=t.querySelector("[dragging]"),s=document.querySelector("[inserting]");if(!e.target.closest("[drag-item]"))return;e.target.hasAttribute("drag-item")&&e.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses),this.lastTopPos=t.documentElement.scrollTop;let a=this.beforeOrAfterEl(e,e.target.closest("[drag-item]"));if(s!=null){this.component().call("insertBlock",s.dataset.block,e.target.closest("[drag-item]").dataset.block,a),s.removeAttribute("inserting"),s=!1;return}a==="after"?e.target.closest("[drag-item]").after(i):e.target.closest("[drag-item]").before(i);let n=Array.from(t.querySelectorAll("[drag-item]")).map(l=>l.dataset.block);this.component().call("reorder",n)})})},isBefore(t,r,e){let i=!1,s=!1,a=!1;return t.querySelectorAll("[drag-item]").forEach(n=>{if(!a&&(i=i?!0:n==r,s=s?!0:n==e,i===!1&&s===!0)){a=!0;return}}),a},beforeOrAfterEl(t,r){let e=r.getBoundingClientRect(),i=e.y,s=i+e.height/2,a=s,n=a+e.height/2,l=t.clientY>=i&&t.clientY<=s,o=t.clientY>=a&&t.clientY<=n;return l?"before":o?"after":!1},component(){return Livewire.find(frame.closest("[wire\\:id]").getAttribute("wire:id"))},undo(t,r){(t.ctrlKey||t.metaKey)&&!t.shiftKey&&t.key==="z"&&(t.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),r.component().call("undo"))},redo(t,r){(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="z"&&(t.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),r.component().call("redo"))}})})();
