(function(){"use strict";window.blockwire=c=>({iframe:null,dropList:null,insert:!1,device:"desktop",lastTopPos:0,cursorPos:0,currentDragItem:null,activeBlockId:null,insertBeforeClasses:["after:opacity-100","after:top-0","after:h-[5px]"],insertAfterClasses:["after:opacity-100","after:bottom-0","after:h-[5px]"],init(){this.iframe=document.getElementById("frame"),this.dropList=document.querySelector("[drop-list]"),document.addEventListener("keydown",t=>this.undo(t,this)),document.addEventListener("keydown",t=>this.redo(t,this)),this.initListeners(),this.iframe.addEventListener("load",()=>{if(this.initListeners(),this.activeBlockId!==null&&this.activeBlockId!==!1){let t=this.iframe.contentWindow.document,r=t.querySelector('[drag-item][data-block="'+this.activeBlockId+'"]');r&&(t.querySelectorAll("[drag-item]").forEach(i=>{i.classList.remove("active")}),r.classList.add("active"))}this.iframe.contentWindow.scrollTo(0,this.lastTopPos)}),Livewire.on("activeBlockIndexChanged",t=>{if(this.activeBlockId=t,this.iframe&&this.iframe.contentWindow){let r=this.iframe.contentWindow.document;if(r.querySelectorAll("[drag-item]").forEach(i=>{i.classList.remove("active")}),t!==!1&&t!==null){let i=r.querySelector('[drag-item][data-block="'+t+'"]');i&&i.classList.add("active")}}})},initListeners(){let t=this.iframe.contentWindow.document;t.addEventListener("keydown",r=>this.undo(r,this)),t.addEventListener("keydown",r=>this.redo(r,this)),this.dropList.querySelectorAll("[drag-item]").forEach(r=>{r.addEventListener("dragstart",i=>{i.target.setAttribute("inserting",!0)}),r.addEventListener("dragend",i=>{i.target.removeAttribute("inserting")}),r.addEventListener("dragover",i=>i.preventDefault())}),t.querySelectorAll("[drop-placeholder]").forEach(r=>{r.addEventListener("dragover",i=>i.preventDefault()),r.addEventListener("dragenter",i=>{i.preventDefault(),i.target.classList.add("bg-gray-200/50","animate-pulse")}),r.addEventListener("dragleave",i=>{i.preventDefault(),i.target.classList.remove("bg-gray-200/50","animate-pulse")}),r.addEventListener("drop",i=>{if(i.preventDefault,!i.target.closest("[drop-placeholder]"))return;let n=document.querySelector("[inserting]");if(n!=null){this.component().call("insertBlock",n.dataset.block,0),n.removeAttribute("inserting"),n=!1;return}})}),t.querySelectorAll("[drag-item]").forEach(r=>{let i=r.querySelector(".action-clone");i&&i.addEventListener("click",e=>{e.stopPropagation();let s=e.target.closest("[drag-item]").dataset.block;this.component().call("cloneBlock",s)});let n=r.querySelector(".action-delete");n&&n.addEventListener("click",e=>{e.stopPropagation();let s=e.target.closest("[drag-item]").dataset.block;this.component().call("deleteBlock",s)}),r.addEventListener("click",e=>{if(e.target.closest(".action-clone")||e.target.closest(".action-delete"))return;let s=e.target.closest("[drag-item]"),a=s.dataset.block;this.activeBlockId=a,t.querySelectorAll("[drag-item]").forEach(l=>{l.classList.remove("active")}),s.classList.add("active"),Livewire.dispatch("blockEditComponentSelected",{blockId:a})},!1),r.addEventListener("dragstart",e=>{e.target.setAttribute("dragging",!0),this.currentDragItem=r}),r.addEventListener("dragover",e=>{e.preventDefault();let s=e.target.closest("[drag-item]");if(this.currentDragItem===s)return;let a=this.beforeOrAfterEl(e,s),l=this.currentDragItem!=null?this.currentDragItem.previousElementSibling:!1,o=this.currentDragItem!=null?this.currentDragItem.nextElementSibling:!1;s!=o&&a==="before"?(s.classList.remove(...this.insertAfterClasses),s.classList.add(...this.insertBeforeClasses)):s!=l&&a==="after"?(s.classList.remove(...this.insertBeforeClasses),s.classList.add(...this.insertAfterClasses)):s.classList.remove(...this.insertBeforeClasses,...this.insertAfterClasses)}),r.addEventListener("dragend",e=>{e.target.removeAttribute("dragging"),this.currentDragItem=null}),r.addEventListener("dragenter",e=>{e.target.hasAttribute("drag-item")&&e.target.setAttribute("is-target",!0)}),r.addEventListener("dragleave",e=>{e.preventDefault,e.target.hasAttribute("is-target")&&e.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses)}),r.addEventListener("drop",e=>{e.preventDefault;let s=t.querySelector("[dragging]"),a=document.querySelector("[inserting]");if(!e.target.closest("[drag-item]"))return;e.target.hasAttribute("drag-item")&&e.target.classList.remove(...this.insertAfterClasses,...this.insertBeforeClasses),this.lastTopPos=t.documentElement.scrollTop;let l=this.beforeOrAfterEl(e,e.target.closest("[drag-item]"));if(a!=null){this.component().call("insertBlock",a.dataset.block,e.target.closest("[drag-item]").dataset.block,l),a.removeAttribute("inserting"),a=!1;return}l==="after"?e.target.closest("[drag-item]").after(s):e.target.closest("[drag-item]").before(s);let o=Array.from(t.querySelectorAll("[drag-item]")).map(d=>d.dataset.block);this.component().call("reorder",o)})})},isBefore(t,r,i){let n=!1,e=!1,s=!1;return t.querySelectorAll("[drag-item]").forEach(a=>{if(!s&&(n=n?!0:a==r,e=e?!0:a==i,n===!1&&e===!0)){s=!0;return}}),s},beforeOrAfterEl(t,r){let i=r.getBoundingClientRect(),n=i.y,e=n+i.height/2,s=e,a=s+i.height/2,l=t.clientY>=n&&t.clientY<=e,o=t.clientY>=s&&t.clientY<=a;return l?"before":o?"after":!1},component(){return Livewire.find(frame.closest("[wire\\:id]").getAttribute("wire:id"))},undo(t,r){(t.ctrlKey||t.metaKey)&&!t.shiftKey&&t.key==="z"&&(t.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),r.component().call("undo"))},redo(t,r){(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="z"&&(t.preventDefault(),navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&window.history.forward(),r.component().call("redo"))}})})();
